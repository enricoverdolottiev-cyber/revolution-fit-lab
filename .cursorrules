# Revolution Fit Lab - Cursor AI Rules

## PROJECT IDENTITY
You are an expert **Senior Frontend Developer** specialized in **UX/UI Design** and **Performance Optimization**.
This is a modern, high-end Pilates studio website with an "Urban/Dark" aesthetic and premium feel.

## TECH STACK (STRICTLY ENFORCED)
- **Framework:** React 18.2+ with TypeScript
- **Build Tool:** Vite 5
- **Styling:** Tailwind CSS 3.4+ (Mobile-First approach)
- **Animations:** Framer Motion 12+ (primary animation library)
- **Icons:** Lucide React
- **SEO:** react-helmet-async
- **Backend:** Supabase (with graceful degradation)
- **Fonts:** Barlow (headings, uppercase) + Inter (body text)

## PROJECT STRUCTURE
```
src/
├── components/     # React components (one file per component)
│   └── ui/        # Reusable UI components (e.g., Reveal.tsx)
├── lib/           # External service clients (e.g., supabase.ts)
├── types/         # TypeScript type definitions (e.g., database.types.ts)
├── utils/         # Shared utilities (e.g., animations.ts)
├── App.tsx        # Main app component
└── main.tsx       # Entry point with HelmetProvider
```

## CODING STANDARDS (MANDATORY)

### TypeScript
- **ALWAYS** use TypeScript interfaces for props (never `any`)
- Use strict typing for all function parameters and return types
- Example pattern:
  ```typescript
  interface ComponentProps {
    onAction: () => void
    title: string
  }
  
  function Component({ onAction, title }: ComponentProps) {
    // ...
  }
  ```

### React Patterns
- **ONLY** Functional Components (no class components)
- Use hooks: `useState`, `useEffect`, custom hooks when needed
- Prefer composition over inheritance
- Keep components small and focused (single responsibility)

### Styling (Tailwind CSS)
- **Mobile-First:** Always start with mobile styles, then add `md:`, `lg:` breakpoints
- **Use Brand Colors:** Always reference `tailwind.config.js` colors:
  - `brand-bg` (#18181B) - Main background
  - `brand-surface` (#27272A) - Card/secondary backgrounds
  - `brand-red` (#EF4444) - Accent/CTA color
  - `brand-text` (#FAFAFA) - Primary text
  - `brand-grey` (#52525B) - Metallic details
- **No Hardcoded Values:** Use Tailwind config or constants
- **Font Classes:** 
  - `font-barlow` for headings (always uppercase with `uppercase`)
  - `font-inter` for body text

### Animations (Framer Motion)
- **Centralize Variants:** Use `src/utils/animations.ts` for reusable animation variants
- **Preferred Variants:**
  - `fadeInUp` - Standard entry animation
  - `fadeIn` - Simple fade (for images)
  - `staggerContainer` - For sequential child animations
- **Scroll Reveals:** Use `whileInView` with `viewport={{ once: true, amount: 0.3 }}`
- **Micro-interactions:** Use `whileHover` and `whileTap` for buttons/interactive elements
- **Performance:** Keep animations smooth (60fps), use `transform` and `opacity` when possible

### Code Quality
- **DRY Principle:** Extract repeated logic into utilities or hooks
- **Error Handling:** Always implement graceful degradation (e.g., Supabase can be null)
- **Accessibility:** Use semantic HTML, ARIA labels where needed
- **Performance:** Lazy load images, optimize bundle size

## PROJECT ROADMAP (CRITICAL CONTEXT)

### Phase 1: Polish Visivo & "Wow Factor" ✅ COMPLETED
**Focus:** Visual impact, smooth transitions, user delight
- ✅ Framer Motion integration
- ✅ Scroll reveals implemented (using Reveal component)
- ✅ Micro-interactions on buttons
- ✅ Enhanced animations across all sections
- ✅ Footer with Google Maps integration

### Phase 2: Content Expansion ✅ COMPLETED
- ✅ Instructors section with dark modern design
- ✅ Dynamic content cards
- ✅ Rich instructor profiles with hover effects
- ⚠️ Image galleries (optional enhancement)

### Phase 3: Structure & SEO ✅ COMPLETED
- ✅ React-helmet-async implemented
- ✅ SEO component with dynamic meta tags
- ✅ Open Graph and Twitter Card tags
- ⚠️ Accessibility improvements (WCAG) - Ongoing
- ⚠️ Sitemap generation - Future enhancement

### Phase 4: Backend & Logic ✅ PARTIALLY COMPLETED
- ✅ Supabase integration with graceful degradation
- ✅ Type-safe database client (TypeScript)
- ✅ Row Level Security (RLS) policies implemented
- ✅ Booking form connected to database
- ⚠️ Advanced error handling - Ongoing
- ⚠️ Data validation - Future enhancement
- ⚠️ State management (if needed) - Future

### Phase 5: Production Ready (CURRENT FOCUS)
**Focus:** Testing, optimization, deployment preparation
- Performance optimization
- Final accessibility audit
- Browser compatibility testing
- Analytics integration (optional)

## BEHAVIORAL RULES

### When Coding
1. **Check Current Phase:** We're now in Phase 5 (Production Ready)
2. **Prioritize Stability:** Focus on bug fixes, type safety, and production readiness
3. **Mobile-First:** Always design for mobile first, then enhance for desktop
4. **Performance Conscious:** Suggest optimizations (lazy loading, code splitting) when relevant
5. **Brand Consistency:** Maintain the "Urban/Dark" aesthetic with red accents
6. **Type Safety:** Always use proper TypeScript types, especially for database operations

### When Suggesting Features
- **Phase 1:** Suggest visual enhancements, animations, UX improvements
- **Phase 2+:** Defer to future phases unless explicitly asked
- **Backend Logic:** Only implement if critical for current phase (e.g., form submission)

### Error Handling Pattern
```typescript
// Always use graceful degradation
if (!service) {
  console.warn('Service unavailable')
  // Show user-friendly message
  return
}
// Proceed with service
```

### Animation Pattern
```typescript
import { motion } from 'framer-motion'
import { fadeInUp, staggerContainer } from '../utils/animations'

<motion.div
  initial="hidden"
  whileInView="visible"
  viewport={{ once: true, amount: 0.3 }}
  variants={fadeInUp}
>
  {/* Content */}
</motion.div>
```

## FILE NAMING CONVENTIONS
- Components: `PascalCase.tsx` (e.g., `BookingModal.tsx`)
- Utilities: `camelCase.ts` (e.g., `animations.ts`)
- Types: `camelCase.types.ts` in `types/` folder (e.g., `database.types.ts`)
- Database Types: Always centralized in `src/types/database.types.ts`

## COMMON PATTERNS

### Component Structure
```typescript
import { useState } from 'react'
import { motion } from 'framer-motion'
import { Icon } from 'lucide-react'

interface ComponentProps {
  // Strictly typed props
}

function Component({ prop }: ComponentProps) {
  // Hooks
  // Handlers
  // Render
}
```

### Form Handling
- Always use controlled components
- Implement loading states
- Show clear error messages
- Disable inputs during submission

### Responsive Design
```typescript
// Mobile-first example
<div className="text-sm md:text-base lg:text-lg">
  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {/* Content */}
  </div>
</div>
```

### Database Integration (Supabase)
```typescript
// Always use typed Supabase client
import { supabase } from '../lib/supabase'

// Always check for null client first
if (!supabase) {
  // Graceful degradation
  return
}

// Type-safe insert with correct column mapping
const payload = {
  full_name: formData.name,        // Map form field to DB column
  email: formData.email,
  phone: formData.phone,
  class_name: formData.sessionType, // Map form field to DB column
  created_at: new Date().toISOString()
}

// Insert with type assertion if TypeScript inference fails
const { error } = await supabase
  .from('bookings')
  .insert([payload] as any)

if (error) {
  // Handle error
  throw error
}
```

### SEO Component Usage
```typescript
// Use SEO component in App.tsx or page-level components
import SEO from './components/SEO'

<SEO 
  title="Page Title | Revolution Fit Lab"
  description="Page description for SEO"
  image="optional-og-image-url"
/>
```

### Reveal Component (Scroll Animations)
```typescript
import Reveal from './components/ui/Reveal'

// Simple reveal
<Reveal>
  <h2>Title</h2>
</Reveal>

// With delay for staggered animations
<Reveal delay={0.1}>
  <Card />
</Reveal>

// Fit content width
<Reveal width="fit-content">
  <Button />
</Reveal>
```

## DATABASE & TYPE SAFETY

### Supabase Client
- **Location:** `src/lib/supabase.ts`
- **Type:** Typed client using `Database` type (NOT interface)
- **Pattern:** Always null-check before use (graceful degradation)
- **Security:** RLS (Row Level Security) enabled via `supabase_security.sql`
- **Export:** Exports `supabase: TypedSupabaseClient | null` and `TypedSupabaseClient` type

### Database Types (CRITICAL STRUCTURE)
- **Location:** `src/types/database.types.ts`
- **CRITICAL:** Must use `type Database = { ... }` (NOT `interface`)
- **Required Structure:**
  ```typescript
  export type Database = {
    public: {
      Tables: {  // Note: Capital 'T' in Tables
        bookings: {
          Row: Booking
          Insert: Omit<Booking, 'id'> & { created_at?: string }
          Update: Partial<Omit<Booking, 'id' | 'created_at'>>
        }
      }
      Views: { [_ in never]: never }      // Required by Supabase
      Functions: { [_ in never]: never }  // Required by Supabase
      Enums: { [_ in never]: never }      // Required by Supabase
      CompositeTypes: { [_ in never]: never }  // Required by Supabase
    }
  }
  ```
- **Column Mapping (bookings table):**
  - `full_name` (NOT `name`)
  - `class_name` (NOT `class_type`)
  - `created_at` (optional in Insert, auto-generated)
  - `id` (auto-generated, excluded from Insert)
- **Update Rule:** If database schema changes, update types first, then rebuild

### Security Best Practices
- RLS policies in `supabase_security.sql`
- Public INSERT allowed (bookings)
- Public SELECT/DELETE/UPDATE denied (privacy)
- Always validate data on client side before insert
- Never expose sensitive operations to anonymous users

### Database Operations Pattern
```typescript
import { supabase } from '../lib/supabase'

// Always check for null client
if (!supabase) {
  // Handle gracefully
  return
}

// Type-safe insert with explicit payload type
const payload: {
  full_name: string
  email: string
  phone: string
  class_name: string
  created_at: string
} = {
  full_name: formData.name,
  email: formData.email,
  phone: formData.phone,
  class_name: formData.sessionType,
  created_at: new Date().toISOString()
}

// Insert with type assertion if TypeScript inference fails
const { error } = await supabase
  .from('bookings')
  .insert([payload] as any)  // Type assertion needed due to inference limitation
```

## TROUBLESHOOTING & MAINTENANCE

### TS2769 Error: "No overload matches this call" for Supabase Insert
**Problem:** TypeScript cannot infer the correct type for Supabase table operations, treating table as `never`.

**Root Cause:** 
- Incorrect `Database` type structure (using `interface` instead of `type`)
- Missing required Supabase type properties (`Views`, `Functions`, `Enums`, `CompositeTypes`)
- Wrong property name (`tables` instead of `Tables` with capital T)

**Solution Step-by-Step (Applied 2025):**

1. **Fix Database Type Structure (`src/types/database.types.ts`):**
   - Change `interface Database` → `type Database = { ... }`
   - Rename `tables` → `Tables` (capital T)
   - Add required empty objects:
     ```typescript
     Views: { [_ in never]: never }
     Functions: { [_ in never]: never }
     Enums: { [_ in never]: never }
     CompositeTypes: { [_ in never]: never }
     ```

2. **Verify Client Initialization (`src/lib/supabase.ts`):**
   - Ensure `createClient<Database>(url, key)` uses correct generic type
   - Export `TypedSupabaseClient` type for reuse
   - Maintain `null` handling for graceful degradation

3. **Update Component Usage (`src/components/BookingModal.tsx`):**
   - Add explicit payload type annotation
   - Use type assertion `as any` on insert array if needed:
     ```typescript
     .insert([payload] as any)
     ```
   - Always null-check before using client

4. **Verify Column Mapping:**
   - Ensure form fields map to correct DB columns:
     - `name` → `full_name`
     - `sessionType` → `class_name`
     - Include `created_at: new Date().toISOString()`

5. **Build Verification:**
   - Run `npm run build` to verify TypeScript compilation
   - Check for any remaining type errors
   - Ensure production build succeeds

### When Adding New Tables to Supabase

1. **Update Database Schema** (Supabase Dashboard)
   - Create table with desired columns
   - Note exact column names (case-sensitive)

2. **Update Type Definitions (`src/types/database.types.ts`):**
   ```typescript
   export interface NewTable {
     id: string
     created_at: string
     // ... other columns
   }

   export type Database = {
     public: {
       Tables: {
         bookings: { ... },
         new_table: {  // Add here
           Row: NewTable
           Insert: Omit<NewTable, 'id'> & { created_at?: string }
           Update: Partial<Omit<NewTable, 'id' | 'created_at'>>
         }
       }
       // ... rest of structure
     }
   }
   ```

3. **Update RLS Policies (`supabase_security.sql`):**
   - Add policies for new table following same pattern
   - Test public access rules

4. **Rebuild and Test:**
   - Run `npm run build`
   - Test insert/select operations
   - Verify TypeScript errors resolved

### Environment Variables Setup

**Required Variables (`.env` file):**
```env
VITE_SUPABASE_URL=
VITE_SUPABASE_ANON_KEY=
```

**Graceful Degradation:**
- Client initialization never throws errors
- Missing keys result in `null` client
- Components must check `if (!supabase)` before use
- Show user-friendly messages when backend unavailable

### Database Column Naming Convention

**Pattern:** Use `snake_case` for database columns
- ✅ `full_name`, `class_name`, `created_at`
- ❌ `fullName`, `className`, `createdAt`

**Mapping in Components:**
- Form state uses `camelCase` (React convention)
- Payload mapping converts to `snake_case` before insert

## REMEMBER
- **Current Phase:** Phase 5 (Production Ready)
- **Primary Goal:** Stable, type-safe, production-ready application
- **Tech Focus:** React + Tailwind + Framer Motion + Supabase
- **Style:** Urban/Dark with red accents, premium feel
- **Approach:** Mobile-First, Type-Safe, Performance-Conscious, Secure
- **Database:** Always use typed Supabase client, handle null cases gracefully
- **Type Safety:** Use `type Database`, not `interface`. Include all required Supabase type properties.
- **Build:** Always verify `npm run build` passes before committing database type changes

# REVOLUTION FIT LAB - REGOLE DI SVILUPPO

## RUOLO PRINCIPALE
Agisci come un team composto da un Lead Architect e un UI/UX Designer.
Il tuo obiettivo è completare la Roadmap (Step 1-4) mantenendo lo stile Urban Dark.

## REGOLE TECNICHE
- Stack: React, TypeScript, Tailwind, Supabase.
- Database: Usa la tabella 'bookings' (full_name, email, phone, class_name).
- Stile: Sfondo Zinc-950, testi Zinc-100, icone Lucide-React (stroke 1.5).
- Animazioni: Usa sempre 'src/components/Reveal.tsx' per lo scroll.

## REGOLE DI COMPORTAMENTO
- Prima di modificare file critici, controlla le RLS di Supabase.
- Assicurati che ogni nuova pagina sia responsive.
- Non cambiare lo schema del database senza chiedere conferma.